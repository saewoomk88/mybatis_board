<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<header>
</header>
<body th:fragment="commet">
<script th:inline="javascript">
    /*<![CDATA[*/
    var bNum = [[${notice.num}]]; //게시글 번호

    $('#write').click(function () {
        var insertData =$('#form').serialize(); // 폼의 내용을 가져온다
        commentInsert(insertData); //함수호출 (아래)
    });

    //댓글 목록
    function commentList() {
        $.ajax({
            url:'/reply/list',
            type:'get',
            data:{'bNum':bNum},
            success: function (data) {
                console.log(data);
                var a ='';
                $.each(data, function(key, value){
                    a+='<div class="col-sm-12 commentArea" >';
                    a+='<div class="col-sm-12">'+value.writer+'</div>';
                    a+='<div class="col-sm-12 d-inline commentInfo'+value.cnum+'" >'+'댓글번호 : '+value.cnum;
                    a+=' <span class="badge badge-pill badge-primary">'+value.reg_date+'</span></div>';
                    a+=' <div class="col-sm-1 d-inline btn">';
                    a+='<a  onclick="commentUpdate('+value.cnum+',\''+value.content+'\');"> <i class="fas fa-edit"></i> </a></div>';
                    a+='<div class="col-sm-1 d-inline btn">';
                    a+='<a onclick="commentDelete('+value.cnum+')"><i class="far fa-trash-alt"></i> </a></div>';
                    a+='</div>';
                    a+=' <div class="col-sm-12 commentContent'+value.cnum+'" style="border-bottom: black solid 1px; "> <p> '+value.content +'</p></div>';

                });

                $('#commentList').html(a);
            }
        })
    }

    //댓글 등록
    function commentInsert(insertData) {
        $.ajax({
            url: '/reply/insert',
            type: 'post',
            data: insertData,
            success: function (data) {
                if(data==1){
                    commentList(); //댓글 작성 후 댓글 목록 reload
                    $('#content').val('');
                }
            }
        })

    }
    //댓글 수정 - 댓글 내용 출력을  input 폼으로 변경
    function commentUpdate(cnum, content) {
        var a='';
        a += '<div class="input-group">';
        a += '<input type="text" class="form-control" name="content_'+cnum+'" value="'+content+'"/>';
        a += '<span class="input-group-btn"><button class="btn btn-default" type="button" onclick="commentUpdateProc('+cnum+');">수정</button> </span>';
        a += '</div>';

        $('.commentContent'+cnum).html(a);

    }

    //댓글수정
    function commentUpdateProc(cnum) {
        var updateContent = $('[name=content_'+cnum+']').val();

        $.ajax({
            url: '/reply/update',
            type: 'post',
            data: {'content': updateContent, 'cNum': cnum},
            success: function (data) {
                if(data==1) commentList(bNum); //댓글 수정 후 목록 출력
            }
        })
    }

    //댓글 삭제
    function commentDelete(cnum) {
        $.ajax({
            url: '/reply/delete/'+cnum,
            type: 'post',
            success: function (data) {
                if(data==1) commentList(bNum); //댓글 수정 후 목록 출력
            }
        })
    }

    $(document).ready(function(){
        commentList(); //페이지 로딩시 댓글 목록 출력
    });


    /*]]>*/

</script>
</body>
</html>